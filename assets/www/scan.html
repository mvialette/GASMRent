<!DOCTYPE HTML>
<html>
	<head>
		<title>G.A.S.M. Rent</title>
		
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		
		<!-- Javascripts -->
		<script type="text/javascript" charset="utf-8" src="./js/cordova.js"></script>
		<script type="text/javascript" charset="utf-8" src="./js/jquery-2.0.3.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="./js/bootstrap.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="./js/respond.min.js"></script>
		<script type="text/javascript" charset="utf-8" src="./js/gasm-rent.js"></script>
		
		<script type="text/javascript">
			window.onload = function() {
				var params = window.location.toString().substr(
						window.location.toString().indexOf('=') + 1);
				
				var equipmentId = params.substr(0,params.indexOf('&'));
				
				var paramsTmp = params.substr(params.indexOf('=')+1);
				
				//paramsTmp = params.substr(params.indexOf('divingEventId='));
				
				var divingEventId = paramsTmp.substr(0,paramsTmp.indexOf('&'));
				
				paramsTmp = paramsTmp.substr(paramsTmp.indexOf('=')+1);
				
				//paramsTmp = paramsTmp.substr(paramsTmp.indexOf('=')+1);
				
				var userId = paramsTmp;
				
				//params = 99A&divingEventId=5666771260407808&userId=5717546363781120
		
				//alert(equipmentId);
				//alert(divingEventId);
				//alert(userId);
				//getInfosFromJackets(itemId);
				
				var RentalRecord = function(divingEventId, userId){
					    this.divingEventId = divingEventId;
					    this.userId = userId;
					    
					    this.jacketId = "null";
						this.regulatorId = "null";
						this.tankId = "null";
				}
				
				$.extend(RentalRecord.prototype, {
					setEquipmentId: function(equipmentId){
						//this.jacketId = equipmentId;
						
						var localStorageEquipments = JSON.parse(window.localStorage
								.getItem("equipments"));
						
						$.each(localStorageEquipments, function(i, oneElement) {
							var jsonOneElement = JSON.parse(oneElement);
							if(jsonOneElement.id == equipmentId){
								return jsonOneElement.type;
							}
						});
						
						/* 
						$.each(localStorageEquipments, function(i, oneElement) {

							// alert(oneUser);
							
							if(jsonOneElement.id == equipmentId){
								//alert(equipmentId);
								if(jsonOneElement.type == 'Tank'){
									this.tankId = equipmentId;
									this.jacketId = "null";
									this.regulatorId = "null";
									break;
								}else if(jsonOneElement.type == 'Regulator'){
									this.regulatorId = equipmentId;
									this.jacketId = "null";
									this.tankId = "null";
									break;
								} else if(jsonOneElement.type == 'Jacket'){
									this.jacketId = equipmentId;
									this.tankId = "null";
									this.regulatorId = "null";
									break;
								}
							}
						}); */
					},
				  	toString: function() {
				    	return 'divingEventId=' + this.divingEventId + '&userId=' + this.userId +'&tankId=' + this.tankId+'&regulatorId=' + this.regulatorId+'&jacketId=' + this.jacketId;
					}
				});
				
				var theNewRentalRecord = new RentalRecord(divingEventId, userId);
				
				alert(theNewRentalRecord.setEquipmentId(equipmentId));
				
				alert(theNewRentalRecord.toString());
				/* var equipmentParamAndId;
				
				

				var urlToCall =  "https://mindful-girder-344.appspot.com/api/rentalRecord/addToDivingEvent/" + divingEventId + "?" + equipmentParamAndId;*/
				
				//https://mindful-girder-344.appspot.com/api/rentalRecord/addToDivingEvent/
				//5666771260407808?jacketId=99B&regulatorId=28&tankId=211&
				///api/rentalRecord/addToDivingEvent/
				//5666771260407808?jacketId=99B&regulatorId=28&tankId=211&
			}
		</script>
		
		<!-- CSS -->
		<link href="./css/bootstrap.min.css" rel="stylesheet" media="screen">
		<link href="./css/gasm.css" rel="stylesheet" media="screen">
	</head>
	<body>
		<div class="container">
			<div class="row">
				<div class="col-12 pageTitle" id="applicationTitle">GASM Rent - Scan</div>
			</div>
			<div class="row">
				<div class="col-12 pageSection">
					<div class="row largeRow">
						<div class="col-12 text-center" id="description">Ici nous
							pourrons scanner un 'QR Code' afin d'identifier un élément, soit à
							envoyer en location, soit à retourner.</div>
					</div>
					<div class="row largeRow">
						<div class="col-12 text-center" id="valeurDuQRCode"></div>
					</div>
	
					<div class="row largeRow">
						<div class="col-12 text-center" id="doAction"></div>
					</div>
	
					<div class="row largeRow">
						<div class="col-12 text-center" id="back">
							<a class="largeButton" href="./index.html">Retour</a>
						</div>
					</div>
				</div>
			</div>
		</div>
	</body>
</html>